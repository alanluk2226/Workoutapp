<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Courses - Fitness App</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .timetable-container {
            margin-top: 2rem;
            overflow-x: auto;
            width: 100%;
        }
        
        .timetable {
            width: 100%;
            min-width: 1200px; /* Increased from 1000px */
            border-collapse: collapse;
            background: var(--color-card-bg);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-lg), 0 4px 12px rgba(0, 255, 127, 0.1);
            border: 1px solid rgba(0, 255, 127, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .timetable th {
            background: linear-gradient(135deg, var(--color-neon-green), #00cc66);
            color: #000;
            padding: 18px 15px; /* Increased padding */
            text-align: center;
            font-weight: var(--font-weight-semibold);
            border: 1px solid rgba(0, 255, 127, 0.3);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-wide);
            font-size: 1rem; /* Increased font size */
            min-width: 180px; /* Increased from 140px */
        }
        
        .timetable td {
            padding: 8px;
            border: 1px solid rgba(0, 255, 127, 0.2);
            text-align: center;
            vertical-align: top;
            min-width: 180px; /* Increased from 140px */
            width: 180px; /* Increased fixed width */
            background: rgba(0, 0, 0, 0.7);
            height: 90px; /* Increased from 70px */
            position: relative;
        }
        
        .course-cell {
            padding: 6px !important; /* Increased padding */
        }
        
        .time-column {
            background: rgba(0, 255, 127, 0.1);
            font-weight: var(--font-weight-semibold);
            width: 120px; /* Increased from 100px */
            min-width: 120px;
            color: var(--color-neon-green);
            border-right: 2px solid rgba(0, 255, 127, 0.3);
            font-size: 1rem; /* Increased font size */
        }
        
        .course-event {
            background: linear-gradient(135deg, rgba(0, 255, 127, 0.2), rgba(0, 255, 127, 0.1));
            color: var(--color-text-light);
            padding: 12px; /* Increased padding */
            border-radius: var(--radius-md);
            font-size: 0.9rem; /* Increased font size */
            cursor: pointer;
            border-left: 4px solid var(--color-neon-green);
            text-align: left;
            transition: all var(--duration-fast) var(--ease-standard);
            border: 1px solid rgba(0, 255, 127, 0.3);
            backdrop-filter: blur(5px);
            position: relative;
            width: 100%;
            box-sizing: border-box;
            min-height: 80px; /* Increased minimum height */
            display: flex;
            flex-direction: column;
            justify-content: center;
            word-wrap: break-word;
            overflow: hidden;
        }
        
        .course-event:hover {
            background: linear-gradient(135deg, rgba(0, 255, 127, 0.3), rgba(0, 255, 127, 0.2));
            transform: scale(1.02);
            box-shadow: var(--shadow-neon);
            z-index: 10;
        }
        
        .course-name {
            font-weight: var(--font-weight-semibold);
            margin-bottom: 6px; /* Increased margin */
            font-size: 1rem; /* Increased font size */
            color: var(--color-neon-green);
            line-height: 1.3; /* Improved line height */
            word-break: break-word;
            text-shadow: 0 0 5px rgba(0, 255, 127, 0.3);
        }
        
        .course-coach {
            font-size: 0.85rem; /* Increased font size */
            opacity: 0.9;
            color: var(--color-text-light);
            margin-bottom: 6px; /* Increased margin */
            line-height: 1.3;
        }
        
        .course-time {
            font-size: 0.8rem; /* Increased font size */
            opacity: 0.8;
            margin-top: 6px;
            color: var(--color-text-light);
            line-height: 1.3;
            font-weight: var(--font-weight-medium);
        }
        
        /* Different sizes for different durations */
        .course-event[style*="height: 90px"] {
            /* 1 hour courses */
            font-size: 0.9rem;
            padding: 12px;
        }
        
        .course-event[style*="height: 170px"] {
            /* 2 hour courses */
            font-size: 0.95rem;
            padding: 15px;
        }
        
        .course-event[style*="height: 260px"] {
            /* 3 hour courses */
            font-size: 1rem;
            padding: 18px;
        }
        
        /* Grouped course indicator */
        .course-event .course-name::after {
            content: '';
            position: absolute;
            top: 4px;
            right: 4px;
            width: 6px;
            height: 6px;
            background: var(--color-neon-green);
            border-radius: 50%;
            opacity: 0;
        }
        
        .course-event[title*="sessions"] .course-name::after {
            opacity: 1;
            animation: pulse 2s infinite;
        }
        
        .course-event.yoga { border-left-color: #4CAF50; }
        .course-event.bodyweight { border-left-color: #FF9800; }
        .course-event.hii { border-left-color: #F44336; }
        .course-event.circuittraining { border-left-color: #9C27B0; }
        .course-event.pilates { border-left-color: #2196F3; }
        .course-event.cardiokickboxing { border-left-color: #795548; }
        .course-event.zumba { border-left-color: #E91E63; }
        
        .course-name {
            font-weight: var(--font-weight-semibold);
            margin-bottom: 2px;
            font-size: 0.75rem;
            color: var(--color-neon-green);
        }
        
        .course-coach {
            font-size: 0.7rem;
            opacity: 0.9;
            color: var(--color-text-light);
        }
        
        .course-time {
            font-size: 0.65rem;
            opacity: 0.8;
            margin-top: 2px;
            color: var(--color-text-light);
        }
        
        /* Mobile Timetable */
        .mobile-timetable {
            display: none;
        }
        
        .mobile-day-section {
            margin-bottom: 2rem;
            background: var(--color-card-bg);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-lg), 0 4px 12px rgba(0, 255, 127, 0.1);
            border: 1px solid rgba(0, 255, 127, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .mobile-day-header {
            background: linear-gradient(135deg, var(--color-neon-green), #00cc66);
            color: #000;
            padding: 15px;
            font-weight: var(--font-weight-semibold);
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-wide);
        }
        
        .mobile-course-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid rgba(0, 255, 127, 0.2);
            transition: all var(--duration-fast) var(--ease-standard);
        }
        
        .mobile-course-row:last-child {
            border-bottom: none;
        }
        
        .mobile-course-row:hover {
            background: rgba(0, 255, 127, 0.1);
        }
        
        .mobile-course-info {
            flex: 1;
        }
        
        .mobile-course-name {
            font-weight: var(--font-weight-semibold);
            margin-bottom: 4px;
            color: var(--color-neon-green);
        }
        
        .mobile-course-details {
            font-size: 0.85rem;
            color: var(--color-text-light);
        }
        
        .mobile-course-type {
            background: linear-gradient(135deg, var(--color-neon-green), #00cc66);
            color: #000;
            padding: 4px 8px;
            border-radius: var(--radius-xl);
            font-size: 0.7rem;
            font-weight: var(--font-weight-semibold);
            margin-left: 10px;
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-wide);
        }
        
        .unenroll-btn {
            background: linear-gradient(135deg, var(--color-error), #dc2626);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: var(--font-weight-medium);
            margin-top: 4px;
            transition: all var(--duration-fast) var(--ease-standard);
        }
        
        .unenroll-btn:hover {
            background: linear-gradient(135deg, #dc2626, var(--color-error));
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--color-text-light);
            background: var(--color-card-bg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg), 0 4px 12px rgba(0, 255, 127, 0.1);
            border: 1px solid rgba(0, 255, 127, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .empty-state h3 {
            color: var(--color-neon-green);
            margin-bottom: var(--space-md);
        }
        
        .empty-state a {
            color: var(--color-neon-green);
            text-decoration: none;
            font-weight: var(--font-weight-semibold);
        }
        
        .empty-state a:hover {
            text-shadow: 0 0 5px rgba(0, 255, 127, 0.5);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .desktop-timetable {
                display: none;
            }
            
            .mobile-timetable {
                display: block;
            }
        }
        
        /* Course Details Modal */
        .course-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: var(--color-card-bg);
            padding: 2rem;
            border-radius: var(--radius-xl);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl), 0 10px 40px rgba(0, 255, 127, 0.2);
            border: 1px solid rgba(0, 255, 127, 0.3);
            backdrop-filter: blur(20px);
            color: var(--color-text-light);
        }
        
        .modal-content h2 {
            color: var(--color-neon-green);
            text-shadow: 0 0 10px rgba(0, 255, 127, 0.3);
            margin-bottom: var(--space-lg);
        }
        
        .modal-content strong {
            color: var(--color-neon-green);
        }
        
        .close-modal {
            float: right;
            font-size: 1.5rem;
            cursor: pointer;
            background: none;
            border: none;
            color: var(--color-neon-green);
            transition: all var(--duration-fast) var(--ease-standard);
            padding: var(--space-xs);
            border-radius: 50%;
        }
        
        .close-modal:hover {
            background: rgba(0, 255, 127, 0.1);
            transform: scale(1.1);
        }
        
        /* Table Responsive */
        @media (max-width: 1200px) {
            .timetable {
                min-width: 900px; /* Reduced minimum width for tablets */
            }
            
            .timetable th,
            .timetable td {
                min-width: 120px;
                width: 120px;
            }
            
            .time-column {
                width: 90px;
                min-width: 90px;
            }
            
            .course-event {
                font-size: 0.75rem;
                padding: 6px;
            }
            
            .course-name {
                font-size: 0.8rem;
            }
            
            .course-coach {
                font-size: 0.7rem;
            }
            
            .course-time {
                font-size: 0.65rem;
            }
        }
        
        @media (max-width: 900px) {
            .timetable {
                min-width: 800px;
            }
            
            .timetable th,
            .timetable td {
                min-width: 100px;
                width: 100px;
                padding: 4px;
            }
            
            .time-column {
                width: 80px;
                min-width: 80px;
            }
            
            .course-event {
                font-size: 0.7rem;
                padding: 5px;
            }
            
            .course-name {
                font-size: 0.75rem;
            }
            
            .course-coach {
                font-size: 0.65rem;
            }
            
            .course-time {
                font-size: 0.6rem;
            }
        }
        
        @media (max-width: 480px) {
            .mobile-course-row {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-sm);
            }
            
            .mobile-course-type {
                margin-left: 0;
                align-self: flex-start;
            }
        }
        
        /* Schedule Info Box */
        .schedule-info {
            background: rgba(0, 255, 127, 0.1);
            border: 1px solid rgba(0, 255, 127, 0.2);
            border-radius: var(--radius-lg);
            padding: var(--space-md);
            margin-bottom: var(--space-lg);
            color: var(--color-text-light);
        }
        
        .schedule-info strong {
            color: var(--color-neon-green);
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="navbar">
            <div class="nav-brand">üèãÔ∏è Fitness Tracker</div>
            <div class="nav-links">
                <a href="/" class="nav-link">Home</a>
                <a href="/courses" class="nav-link">Courses</a>
                <a href="/my-courses" class="nav-link active">My Courses</a>
                <a href="/create" class="nav-link">Workouts</a>
                <% if (user) { %>
                    <div class="user-info">
                        <span>Welcome, <%= user.username %>!</span>
                        <a href="/logout" class="btn btn-danger">Logout</a>
                    </div>
                <% } else { %>
                    <a href="/login" class="nav-link">Login</a>
                <% } %>
            </div>
        </nav>

        <div class="card">
            <div class="card-header">
                <h1 class="card-title">My Course Schedule üìÖ</h1>
                <p>Your weekly fitness course timetable</p>
            </div>

            <div id="enrollmentsList" class="timetable-container">
                <div style="text-align: center; padding: 2rem;">
                    <p>Loading your course schedule...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Ë™≤Á®ãË©≥ÊÉÖÂΩàÁ™ó -->
    <div id="courseModal" class="course-modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">&times;</button>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        let currentEnrollments = [];
        
        // ËºâÂÖ•Áî®Êà∂ÁöÑË™≤Á®ã
        async function loadMyCourses() {
            try {
                const response = await fetch('/api/my-courses');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    currentEnrollments = data.enrollments;
                    displayTimetable(data.enrollments);
                } else {
                    throw new Error(data.error || 'Failed to load courses');
                }
            } catch (error) {
                console.error('Error loading courses:', error);
                document.getElementById('enrollmentsList').innerHTML = `
                    <div class="empty-state">
                        <h3>Error Loading Courses</h3>
                        <p style="color: var(--color-error);">Unable to load your course schedule. Please try refreshing the page.</p>
                        <button onclick="loadMyCourses()" class="btn btn-primary" style="margin-top: 1rem;">
                            Try Again
                        </button>
                    </div>
                `;
            }
        }
        
        // È°ØÁ§∫ÊôÇÈñìË°®
        function displayTimetable(enrollments) {
            try {
                const container = document.getElementById('enrollmentsList');
                
                if (!enrollments || enrollments.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No courses enrolled yet</h3>
                            <p>Browse our <a href="/courses">fitness courses</a> and start your journey!</p>
                        </div>
                    `;
                    return;
                }
                
                // ÁîüÊàêÊôÇÈñìË°®
                container.innerHTML = `
                    <div class="desktop-timetable">
                        ${generateDesktopTimetable(enrollments)}
                    </div>
                    <div class="mobile-timetable">
                        ${generateMobileTimetable(enrollments)}
                    </div>
                `;
                
            } catch (error) {
                console.error('Error displaying timetable:', error);
                document.getElementById('enrollmentsList').innerHTML = `
                    <div class="empty-state">
                        <h3>Display Error</h3>
                        <p style="color: var(--color-error);">Error displaying your course schedule.</p>
                        <button onclick="loadMyCourses()" class="btn btn-primary" style="margin-top: 1rem;">
                            Reload
                        </button>
                    </div>
                `;
            }
        }
        
        // ÁîüÊàêÊ°åÈù¢ÁâàË°®Ê†ºÊôÇÈñìË°®
        function generateDesktopTimetable(enrollments) {
            try {
                const timeSlots = [
                    '06:00', '07:00', '08:00', '09:00', '10:00', '11:00', '12:00',
                    '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00'
                ];
                
                const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
                const dayNames = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
                
                // Create a grid to track occupied cells
                const occupiedCells = {};
                
                let html = `
                    <table class="timetable">
                        <thead>
                            <tr>
                                <th>Time</th>
                                ${dayNames.map(day => `<th>${day}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                // Generate each time slot row
                timeSlots.forEach((time, timeIndex) => {
                    html += `<tr>`;
                    html += `<td class="time-column">${formatDisplayTime(time)}</td>`;
                    
                    days.forEach(day => {
                        const cellKey = `${day}-${timeIndex}`;
                        
                        // Skip if this cell is occupied by a course from previous row
                        if (occupiedCells[cellKey]) {
                            return; // Don't add <td> for occupied cells
                        }
                        
                        // Find courses that start at this time slot
                        const coursesInSlot = enrollments.filter(enrollment => {
                            const course = enrollment.course;
                            return course.schedule.day === day && 
                                   course.schedule.startTime === time;
                        });
                        
                        if (coursesInSlot.length > 0) {
                            // Group similar courses
                            const groupedCourses = groupSimilarCourses(coursesInSlot);
                            const courseGroup = groupedCourses[0]; // Take first group
                            const course = courseGroup[0].course;
                            const count = courseGroup.length;
                            
                            // Calculate duration and rowspan
                            const startMinutes = timeToMinutes(course.schedule.startTime);
                            const endMinutes = timeToMinutes(course.schedule.endTime);
                            const durationHours = (endMinutes - startMinutes) / 60;
                            const rowSpan = Math.max(1, Math.round(durationHours));
                            
                            // Mark cells as occupied for the duration of this course
                            for (let i = 0; i < rowSpan; i++) {
                                const occupiedKey = `${day}-${timeIndex + i}`;
                                occupiedCells[occupiedKey] = true;
                            }
                            
                            html += `
                                <td rowspan="${rowSpan}" class="course-cell" style="vertical-align: top;">
                                    <div class="course-event ${course.type}" 
                                         onclick="showCourseDetails('${course._id}')"
                                         title="${course.name} - ${course.coach.name}${count > 1 ? ` (${count} sessions)` : ''}"
                                         style="height: ${rowSpan * 90 - 10}px; display: flex; flex-direction: column; justify-content: center;">
                                        <div class="course-name">${getShortCourseName(course.name)}${count > 1 ? ` (${count})` : ''}</div>
                                        <div class="course-coach">${course.coach.name}</div>
                                        <div class="course-time">${formatDisplayTime(course.schedule.startTime)} - ${formatDisplayTime(course.schedule.endTime)}</div>
                                    </div>
                                </td>
                            `;
                        } else {
                            html += `<td></td>`;
                        }
                    });
                    
                    html += `</tr>`;
                });
                
                html += `</tbody></table>`;
                return html;
                
            } catch (error) {
                console.error('Error generating desktop timetable:', error);
                return `<div style="color: red; text-align: center;">Error generating timetable. Please refresh the page.</div>`;
            }
        }
        
        // Group similar courses together
        function groupSimilarCourses(enrollments) {
            try {
                const groups = [];
                const processed = new Set();
                
                enrollments.forEach((enrollment, index) => {
                    if (processed.has(index)) return;
                    
                    const course = enrollment.course;
                    const similarCourses = [enrollment];
                    processed.add(index);
                    
                    // Find other courses with same name, coach, and time
                    enrollments.forEach((otherEnrollment, otherIndex) => {
                        if (processed.has(otherIndex) || index === otherIndex) return;
                        
                        const otherCourse = otherEnrollment.course;
                        
                        if (course.name === otherCourse.name &&
                            course.coach._id === otherCourse.coach._id &&
                            course.schedule.startTime === otherCourse.schedule.startTime &&
                            course.schedule.endTime === otherCourse.schedule.endTime &&
                            course.schedule.day === otherCourse.schedule.day) {
                            
                            similarCourses.push(otherEnrollment);
                            processed.add(otherIndex);
                        }
                    });
                    
                    groups.push(similarCourses);
                });
                
                return groups;
                
            } catch (error) {
                console.error('Error grouping courses:', error);
                return enrollments.map(e => [e]); // Return individual courses if grouping fails
            }
        }
        
        // ÁîüÊàêÊâãÊ©üÁâàÊôÇÈñìË°®
        function generateMobileTimetable(enrollments) {
            try {
                const days = [
                    'monday', 'tuesday', 'wednesday', 'thursday', 
                    'friday', 'saturday', 'sunday'
                ];
                const dayNames = {
                    monday: 'Monday',
                    tuesday: 'Tuesday',
                    wednesday: 'Wednesday',
                    thursday: 'Thursday',
                    friday: 'Friday',
                    saturday: 'Saturday',
                    sunday: 'Sunday'
                };
                
                let html = '';
                
                days.forEach(day => {
                    const dayCourses = enrollments.filter(enrollment => 
                        enrollment.course.schedule.day === day
                    );
                    
                    if (dayCourses.length > 0) {
                        // Group similar courses for mobile view too
                        const groupedCourses = groupSimilarCourses(dayCourses);
                        
                        html += `
                            <div class="mobile-day-section">
                                <div class="mobile-day-header">${dayNames[day]}</div>
                                ${groupedCourses.map(group => {
                                    const course = group[0].course; // Use first course as representative
                                    const count = group.length;
                                    
                                    return `
                                        <div class="mobile-course-row">
                                            <div class="mobile-course-info">
                                                <div class="mobile-course-name">${course.name}${count > 1 ? ` (${count} sessions)` : ''}</div>
                                                <div class="mobile-course-details">
                                                    ${formatTime(course.schedule.startTime)} - ${formatTime(course.schedule.endTime)} ‚Ä¢ ${course.coach.name}
                                                </div>
                                                <button class="unenroll-btn" onclick="unenrollCourseGroup('${group.map(g => g.course._id).join(',')}')">
                                                    Unenroll${count > 1 ? ` (${count})` : ''}
                                                </button>
                                            </div>
                                            <span class="mobile-course-type">${course.type.toUpperCase()}</span>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        `;
                    }
                });
                
                return html;
                
            } catch (error) {
                console.error('Error generating mobile timetable:', error);
                return `<div style="color: red; text-align: center;">Error generating mobile timetable. Please refresh the page.</div>`;
            }
        }
        
        // Â∑•ÂÖ∑ÂáΩÊï∏
        function isTimeInSlot(slotTime, startTime, endTime) {
            // Convert times to minutes for easier comparison
            const slotMinutes = timeToMinutes(slotTime);
            const startMinutes = timeToMinutes(startTime);
            const endMinutes = timeToMinutes(endTime);
            
            // Check if the slot time falls within the course time range
            return slotMinutes >= startMinutes && slotMinutes < endMinutes;
        }
        
        function timeToMinutes(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }
        
        function formatDisplayTime(time) {
            // Convert 24-hour format to 12-hour format for display
            const [hours, minutes] = time.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour % 12 || 12;
            return `${displayHour}:${minutes} ${ampm}`;
        }
        
        function getShortCourseName(name) {
            // With bigger boxes, we can show more text
            if (name.length <= 25) return name; // Show full name if it's not too long
            
            const words = name.split(' ');
            if (words.length <= 4) return name; // Show full name if 4 words or less
            
            // For longer names, show first 4 words
            return words.slice(0, 4).join(' ') + '...';
        }
        
        function formatTime(time) {
            // This function is for mobile display
            const [hours, minutes] = time.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour % 12 || 12;
            return `${displayHour}:${minutes} ${ampm}`;
        }
        
        function formatDay(day) {
            const days = {
                monday: 'Monday',
                tuesday: 'Tuesday',
                wednesday: 'Wednesday',
                thursday: 'Thursday',
                friday: 'Friday',
                saturday: 'Saturday',
                sunday: 'Sunday'
            };
            return days[day] || day;
        }
        
        // È°ØÁ§∫Ë™≤Á®ãË©≥ÊÉÖ
        function showCourseDetails(courseId) {
            const enrollment = currentEnrollments.find(e => e.course._id === courseId);
            if (!enrollment) return;
            
            const course = enrollment.course;
            const modalContent = document.getElementById('modalContent');
            
            modalContent.innerHTML = `
                <h2>${course.name}</h2>
                <div style="display: flex; align-items: center; gap: 1rem; margin: 1rem 0;">
                    <img src="${course.coach.image || '/images/default-coach.jpg'}" 
                         alt="${course.coach.name}" 
                         style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 2px solid rgba(0, 255, 127, 0.3);"
                         onerror="this.src='/images/default-coach.jpg'">
                    <div>
                        <strong>Coach: ${course.coach.name}</strong><br>
                        <span style="color: var(--color-text-light);">${course.coach.specialization.join(', ')}</span>
                    </div>
                </div>
                
                <div class="schedule-info">
                    <strong>Schedule:</strong><br>
                    ${formatDay(course.schedule.day)}<br>
                    ${formatTime(course.schedule.startTime)} - ${formatTime(course.schedule.endTime)}
                </div>
                
                <p><strong>Description:</strong> <span style="color: var(--color-text-light);">${course.description}</span></p>
                <p><strong>Participants:</strong> <span style="color: var(--color-text-light);">${course.currentParticipants}/${course.maxParticipants}</span></p>
                <p><strong>Enrolled on:</strong> <span style="color: var(--color-text-light);">${new Date(enrollment.enrolledAt).toLocaleDateString()}</span></p>
                
                <button class="unenroll-btn" onclick="unenrollCourse('${course._id}'); closeModal();" style="margin-top: 1rem; padding: 10px 16px;">
                    Unenroll from Course
                </button>
            `;
            
            document.getElementById('courseModal').style.display = 'flex';
        }
        
        // ÈóúÈñâÂΩàÁ™ó
        function closeModal() {
            document.getElementById('courseModal').style.display = 'none';
        }
        
        // ÂèñÊ∂àË®ªÂÜä
        async function unenrollCourse(courseId) {
            if (!confirm('Are you sure you want to unenroll from this course?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/courses/${courseId}/unenroll`, {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Successfully unenrolled from the course', 'success');
                    loadMyCourses(); // ÈáçÊñ∞ËºâÂÖ•
                } else {
                    showNotification('Error: ' + data.error, 'error');
                }
            } catch (error) {
                console.error('Unenroll error:', error);
                showNotification('Error unenrolling from course. Please try again.', 'error');
            }
        }
        
        // ÂèñÊ∂àË®ªÂÜäÂ§öÂÄãÁõ∏ÂêåË™≤Á®ã
        async function unenrollCourseGroup(courseIds) {
            const ids = courseIds.split(',');
            const courseCount = ids.length;
            
            if (!confirm(`Are you sure you want to unenroll from ${courseCount > 1 ? 'these ' + courseCount + ' sessions' : 'this course'}?`)) {
                return;
            }
            
            try {
                let successCount = 0;
                let errorCount = 0;
                
                // Unenroll from each course in the group
                for (const courseId of ids) {
                    try {
                        const response = await fetch(`/api/courses/${courseId}/unenroll`, {
                            method: 'POST'
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            successCount++;
                        } else {
                            errorCount++;
                        }
                    } catch (error) {
                        errorCount++;
                    }
                }
                
                if (successCount > 0) {
                    showNotification(`Successfully unenrolled from ${successCount} course${successCount > 1 ? 's' : ''}`, 'success');
                }
                
                if (errorCount > 0) {
                    showNotification(`Failed to unenroll from ${errorCount} course${errorCount > 1 ? 's' : ''}`, 'error');
                }
                
                loadMyCourses(); // ÈáçÊñ∞ËºâÂÖ•
                
            } catch (error) {
                console.error('Unenroll group error:', error);
                showNotification('Error unenrolling from courses. Please try again.', 'error');
            }
        }
        
        // Notification function
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = 'notification animate-slide-up';
            
            const colors = {
                success: 'var(--color-success)',
                error: 'var(--color-error)',
                info: 'var(--color-primary)',
                warning: 'var(--color-accent)'
            };
            
            notification.style.cssText = `
                position: fixed;
                top: var(--space-lg);
                right: var(--space-lg);
                padding: var(--space-md) var(--space-lg);
                border-radius: var(--radius-lg);
                color: white;
                font-weight: var(--font-weight-medium);
                font-family: var(--font-primary);
                z-index: 1000;
                backdrop-filter: blur(20px);
                border: 1px solid ${colors[type] || colors.info};
                box-shadow: var(--shadow-lg), 0 8px 25px ${colors[type] || colors.info}33;
                background: linear-gradient(135deg, ${colors[type] || colors.info}, ${colors[type] || colors.info}dd);
                max-width: 400px;
                word-wrap: break-word;
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut var(--duration-moderate) var(--ease-acceleration)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 350);
            }, 4000);
        }
        
        // ÈªûÊìäÂΩàÁ™óÂ§ñÈÉ®ÈóúÈñâ
        window.onclick = function(event) {
            const modal = document.getElementById('courseModal');
            if (event.target === modal) {
                closeModal();
            }
        }
        
        // È†ÅÈù¢ËºâÂÖ•ÊôÇÁç≤ÂèñË™≤Á®ã
        document.addEventListener('DOMContentLoaded', loadMyCourses);
    </script>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>Contact Us</h4>
                <p>
                    <span class="footer-icon">üìß</span>
                    <a href="mailto:alanluk2226@gmail.com">alanluk2226@gmail.com</a>
                </p>
            </div>
            <div class="footer-section">
                <h4>Alan Workout</h4>
                <p>Your fitness journey starts here</p>
            </div>
            <div class="footer-section">
                <h4>Follow Your Progress</h4>
                <p>Track workouts, join courses, achieve goals</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 Alan Workout. All Rights Reserved.</p>
        </div>
    </footer>

    <script src="/js/navigation.js"></script>
    <script src="/js/chatbot.js"></script>
</body>
</html>
